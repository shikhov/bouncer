# Bouncer
Простой, но рабочий антиспам-бот для Telegram

Существующие боты (например, с капчей) меня не устраивали тем, что отвлекали своей работой всех участников чата. При этом пользователи часто видели само спам-сообщение до того, как бот его подчистит. Этот бот все делает абсолютно незаметно для участников. Логика работы простая, но и действия спамеров обычно очень прямолинейны, так что 95% спама отсекается без проблем и вмешательства администратора.

Как работает бот: если первое текстовое сообщение от нового пользователя (который впервые вошел в чат) похоже на спам (см. далее) — удаляет сообщение и банит пользователя. Если первое сообщение было без текста (фото, стикер и т.д.) — пользователь не считается пока спамером, но и легитимным тоже (до первого сообщения с текстом). Пользователи, уже находящиеся в чате на момент включения в него бота, считаются легитимными и не проверяются на спам.

Критерии спама:
- сообщение содержит ссылки, упоминания или кастомные эмоджи
- сообщение подпадает под заданные регулярные выражения
- сообщение содержит кнопки

Уведомление о спаме и само спам-сообщение отправляются администратору для контроля. Если был забанен легитимный пользователь, администратор может отправить команду `unban` в ответ на уведомление, пользователь будет разбанен (но не включен обратно в чат). Разбан работает только в супергруппах.


Также бот удаляет некоторые виды сообщений:
- сообщения о входе новых пользователей в чат
- сообщения от имени каналов. Такие сообщения являются анонимными (не содержат информации о реальном отправителе), проще их просто запретить


## Реализация
Приложение написано на Python 3.10 с использованием фреймворка Aiogram. Хранение данных в MongoDB. Для развертывания прилагается Dockerfile.

## Развертывание

- Заполнить `config.py`:
  - `DBNAME` — имя БД
  - `CONNSTRING` — строка соединения с MongoDB
- Создать БД с именем, указанным в `config.py`, в ней создать коллекции settings и users
- В коллекции settings создать документ с _id: "settings" и заполнить его:
    - `TOKEN` — токен бота
    - `ADMINCHATID` — ID чата администратора
    - `REGEX_LIST` —  список регулярных выражений
    - `ALLOWED_CHATS` — список ID разрешенных чатов. Бот будет работать только в этих чатах, а из других сразу выходить. Если его не заполнить, любой сможет добавить вашего бота в чат, где бот будет пытаться администрировать и заполнять БД лишними записями

Пример:
```json
 "_id": "settings",
  "TOKEN": "12345:AAAAABBBBBBBBCCCCCCCDDDD",
  "ADMINCHATID": 68651304,
  "REGEX_LIST": [
    "крипт",
    "битко(и|й)н"
  ],
  "ALLOWED_CHATS": [
      -1001234567890
  ]
```

- Развернуть Dockerfile
- Добавить бота в чат и сделать его администратором